

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OpenWeatherMap &mdash; openHAB Helper Libraries  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sonos" href="Sonos.html" />
    <link rel="prev" title="Mode (Time of Day)" href="Mode (Time of Day).html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> openHAB Helper Libraries
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting Started/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting Started/File Locations.html">File Locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting Started/First Steps.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Getting Started/VS Code.html">Setting up VSCode</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Rules.html">Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Triggers.html">Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/Event Object Attributes.html">Event Object Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Examples/Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Guides/But How Do I.html">But How Do I…?</a></li>
</ul>
<p class="caption"><span class="caption-text">Python</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Core.html">Core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Community.html">Community</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Alexa Speak and Respond.html">Alexa Speak and Respond</a></li>
<li class="toctree-l2"><a class="reference internal" href="Area Triggers and Actions.html">Area Triggers and Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="AutoRemote.html">AutoRemote</a></li>
<li class="toctree-l2"><a class="reference internal" href="ClickaTell.html">ClickaTell</a></li>
<li class="toctree-l2"><a class="reference internal" href="Delete and Rediscover Z-Wave Things.html">Delete and Rediscover Z-Wave Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="Esper.html">Esper</a></li>
<li class="toctree-l2"><a class="reference internal" href="Mode (Time of Day).html">Mode (Time of Day)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OpenWeatherMap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-the-script">Upgrading the Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requires">Requires</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Sonos.html">Sonos</a></li>
<li class="toctree-l2"><a class="reference internal" href="WeatherStationUploader.html">WeatherStationUploader</a></li>
<li class="toctree-l2"><a class="reference internal" href="ideAlarm.html">ideAlarm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">JavaScript</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../JavaScript/Reference.html">Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Contributing/Coding Guidelines.html">Coding Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Contributing/Writing Docs.html">Writing Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">openHAB Helper Libraries</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../Community.html">Community</a> &raquo;</li>
        
      <li>OpenWeatherMap</li>
    
    
      <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/openhab-scripters/openhab-helper-libraries/">GitHub Repository</a>
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-scripts.community.openweathermap.owm_daily_forecast">
<span id="openweathermap"></span><h1>OpenWeatherMap<a class="headerlink" href="#module-scripts.community.openweathermap.owm_daily_forecast" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>This rule will create and link the ~700 Items and groups needed to get daily
forecasts from the OWM binding using a free API key. It will also install the
Scale transformation service, if it is not already installed. There is also a
function that was used for testing purposes, which can be used to remove all
the Items and groups. As the day progresses, there will be fewer hourly
forecasts included in the gForecast_1 group.</p>
<p>You may want to comment out several groups and Items that you do not plan on
using, but the Forecast_Timestamp Items are required for the script to function. The
rule will also run when the script file is saved, or OH is restarted, so that
you don’t have to wait for the trigger for the Item states to be populated.</p>
<p>The rule will arrange Items into the following group structure for days(X) 1-5.
gForecast_1 contains the forecast Items for the rest of the current day, and
the current Items, since at some time there won’t be any more forecasts left in
the day. The other groups contain Items for subsequent days. The rule is set
to trigger every time the binding pulls in new values.</p>
<p>Group labels will be updated to reflect the name of the day, and Item labels
will be updated to show the time of the forecast, based on the time provided in
the Forecast_Timestamp_XX Item.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>gWeather
    gOpenWeatherMap
        gCurrent
        gForecast_X
            gForecast_Temperature_X
            gForecast_Pressure_X
            gForecast_Humidity_X
            gForecast_WindSpeed_X
            gForecast_WindDirection_X
            gForecast_Cloudiness_X
            gForecast_RainVolume_X
            gForecast_SnowVolume_X
</pre></div>
</div>
</div>
<div class="section" id="upgrading-the-script">
<h2>Upgrading the Script<a class="headerlink" href="#upgrading-the-script" title="Permalink to this headline">¶</a></h2>
<p>When upgrading this script, remove the comment from the line containing
<code class="docutils literal notranslate"><span class="pre">removeOWMItems()</span></code>, so that all of the Items and Groups can be recreated
using the updated definitions. If you do not do this, erros are likely to
occur. In previous versions of the helper libraries, Items created using the
libraries were not persisted after an OH restart. This has now been corrected.
It is always best to upgrade the libraries and community scripts at the same
time.</p>
</div>
<div class="section" id="requires">
<h2>Requires<a class="headerlink" href="#requires" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>OpenWeatherMap binding</p></li>
<li><p>OpenWeatherMap Account Thing, configured with a free API key</p></li>
<li><p>OpenWeatherMap Weather and Forecast Thing, configured with ‘Number of Hours’
set to 120 and ‘Number of Days’ set to 0. The hours could be less (this is
maxed out for a free API key), but you’ll need to adjust the script.</p></li>
<li><p>All OWM Items should be removed before using rule</p></li>
<li><p>The SCALE transformation service is required, but it will be installed for
you. If you manually editted the ‘transformation’ line in addons.cfg, be
sure to add it there, or it will uninstall next OH update or cache clearing.</p></li>
</ul>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>ArithmeticGroupFunction.Avg does not properly average angles. An ESH issue
has been opened for this… <a class="reference external" href="https://github.com/eclipse/smarthome/issues/6792">https://github.com/eclipse/smarthome/issues/6792</a>.
I noticed the units for the Cloudiness and Humidity groups display as ‘one’,
but the Items display properly as ‘%’.</p></li>
</ul>
</div>
<div class="section" id="change-log">
<h2>Change Log<a class="headerlink" href="#change-log" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>01/11/19: Corrected an issue where the Items were not linking.</p></li>
<li><p>01/12/19: Removed Forecast_Temperature_X, and added
Forecast_Temperature_High_X and Forecast_Temperature_Low_X</p></li>
<li><p>01/16/19: Restructured how the rule is created</p></li>
<li><p>01/16/19: Fixed SCALE transformation install</p></li>
<li><p>01/16/19: Fixed Item existence check</p></li>
<li><p>01/16/19: Changed to using values of Timestamp Items for calculating the
number of remaining forecasts, and the Item label times</p></li>
<li><p>01/16/19: Added group label changes to reflect current day of week</p></li>
<li><p>01/16/19: Changed Item label to use time from Timestamp Items</p></li>
<li><p>01/16/19: Added IconID</p></li>
<li><p>01/16/19: Added manual group aggregation for Condition, ConditionID, Icon,
IconID, and WindDirection</p></li>
<li><p>01/18/19: Fixed issue with Items not being added to groups properly</p></li>
<li><p>01/18/19: Added a NULL check when manually setting group aggregation values</p></li>
<li><p>01/20/19: Fixed improper log entry after SCALE transform has been installed</p></li>
<li><p>02/04/19: Added check to make sure a Thing with ThingUID
‘openweathermap:forecast-and-weather’ exists and is ONLINE</p></li>
<li><p>02/06/19: Added verification that the forecastHours and forecastDays are
configured properly in the Thing</p></li>
<li><p>05/31/19: Fixed Cloudiness and Humidity units and group function (no more
unit of ‘one’!)</p></li>
</ul>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">core.log</span> <span class="kn">import</span> <span class="n">logging</span><span class="p">,</span> <span class="n">LOG_PREFIX</span><span class="p">,</span> <span class="n">log_traceback</span>

<span class="nd">@log_traceback</span>
<span class="k">def</span> <span class="nf">removeOWMItems</span><span class="p">():</span>
    <span class="n">removeOWMItems</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;{}.removeOWMItems&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOG_PREFIX</span><span class="p">))</span>
    <span class="kn">from</span> <span class="nn">core.items</span> <span class="kn">import</span> <span class="n">remove_item</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItemsByTag</span><span class="p">(</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">):</span>
        <span class="n">removeOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;removeOWMItems: [{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">remove_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # use this as a last resort, but make sure it&#39;s not removing any Items not</span>
<span class="sd">    created by this script</span>

<span class="sd">    for item in ir.getAll():</span>
<span class="sd">        if &quot;Forecast_&quot; in item.name or &quot;Current_&quot; in item.name:</span>
<span class="sd">            removeOWMItems.log.debug(&quot;removeOWMItems: [{}]&quot;.format(item))</span>
<span class="sd">            remove_item(item)</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="c1">#removeOWMItems()</span>

<span class="k">def</span> <span class="nf">addOWMItems</span><span class="p">():</span>
    <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;{}.addOWMItems&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOG_PREFIX</span><span class="p">))</span>

    <span class="c1"># create OWM Items and groups, if they do not exist</span>
    <span class="n">scriptExtension</span><span class="o">.</span><span class="n">importPreset</span><span class="p">(</span><span class="s2">&quot;RuleSupport&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">javax.measure.quantity</span> <span class="kn">import</span> <span class="n">Dimensionless</span><span class="p">,</span> <span class="n">Temperature</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">Speed</span><span class="p">,</span> <span class="n">Pressure</span><span class="c1">#, Angle</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">org.openhab.core.thing</span> <span class="kn">import</span> <span class="n">ThingTypeUID</span>
        <span class="kn">from</span> <span class="nn">org.openhab.core.thing</span> <span class="kn">import</span> <span class="n">ChannelUID</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">org.eclipse.smarthome.core.thing</span> <span class="kn">import</span> <span class="n">ThingTypeUID</span>
        <span class="kn">from</span> <span class="nn">org.eclipse.smarthome.core.thing</span> <span class="kn">import</span> <span class="n">ChannelUID</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">org.eclipse.smarthome.core.library.types</span> <span class="kn">import</span> <span class="n">QuantityTypeArithmeticGroupFunction</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">org.openhab.core.library.types</span> <span class="kn">import</span> <span class="n">QuantityTypeArithmeticGroupFunction</span>

    <span class="kn">from</span> <span class="nn">core.items</span> <span class="kn">import</span> <span class="n">add_item</span>
    <span class="kn">from</span> <span class="nn">core.links</span> <span class="kn">import</span> <span class="n">add_link</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">owmThingUID</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">things</span><span class="o">.</span><span class="n">getAll</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">thing</span><span class="o">.</span><span class="n">getThingTypeUID</span><span class="p">()</span> <span class="o">==</span> <span class="n">ThingTypeUID</span><span class="p">(</span><span class="s2">&quot;openweathermap:weather-and-forecast&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">statusInfo</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;ONLINE&quot;</span><span class="p">:</span>
                    <span class="n">thingConfiguration</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">getConfiguration</span><span class="p">()</span>
                    <span class="n">forecastHours</span> <span class="o">=</span> <span class="n">thingConfiguration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;forecastHours&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">forecastHours</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;120&quot;</span><span class="p">:</span>
                        <span class="n">forecastDays</span> <span class="o">=</span> <span class="n">thingConfiguration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;forecastDays&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">forecastDays</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
                            <span class="n">owmThingUID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">getUID</span><span class="p">())</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Thing found, but forecastDays is not set to [0]: forecastDays=[{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forecastDays</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Thing found, but forecastHours is not set to [120]: forecastHours=[{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forecastHours</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Thing found, but statusInfo was not [ONLINE]: statusInfo=[{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">statusInfo</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">owmThingUID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Thing found with ThingTypeUID &#39;openweathermap:weather-and-forecast&#39;, or it was not ONLINE, or it was improperly configured for the free API. Exiting script.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;owmThingUID set to [{}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">owmThingUID</span><span class="p">))</span>

            <span class="c1"># install Scale transformation service, if not already</span>
            <span class="kn">from</span> <span class="nn">org.eclipse.smarthome.model.script.actions.Exec</span> <span class="kn">import</span> <span class="n">executeCommandLine</span>
            <span class="kn">import</span> <span class="nn">json</span>

            <span class="n">scaleCheckResult</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">executeCommandLine</span><span class="p">(</span><span class="s2">&quot;/bin/sh@@-c@@/usr/bin/curl -s --connect-timeout 10 -m 10 -X GET -H </span><span class="se">\&quot;</span><span class="s2">Accept: application/json</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">http://localhost:8080/rest/extensions/transformation-scale</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="mi">15000</span><span class="p">))[</span><span class="s1">&#39;installed&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scaleCheckResult</span><span class="p">:</span>
                <span class="n">installScaleResult</span> <span class="o">=</span> <span class="n">executeCommandLine</span><span class="p">(</span><span class="s2">&quot;/bin/sh@@-c@@/usr/bin/curl -o /dev/null -s -w </span><span class="se">\&quot;</span><span class="s2">%{http_code}</span><span class="se">\&quot;</span><span class="s2"> --connect-timeout 10 -m 10 -X POST -H </span><span class="se">\&quot;</span><span class="s2">Content-Type: application/json</span><span class="se">\&quot;</span><span class="s2"> -H </span><span class="se">\&quot;</span><span class="s2">Accept: application/json</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">http://localhost:8080/rest/extensions/transformation-scale/install</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="mi">15000</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">installScaleResult</span> <span class="o">!=</span> <span class="s2">&quot;200&quot;</span><span class="p">:</span>
                    <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scale transformation service installation failed&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scale transformation service has been installed&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scale transformation service is already installed&quot;</span><span class="p">)</span>

            <span class="c1"># create Current group and Items</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gOpenWeatherMap&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gOpenWeatherMap&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gWeather&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gOpenWeatherMap&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Timestamp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Timestamp&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Timestamp_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Timestamp [%1$tY-%1$tm-%1$td %1$tI:%1$tM%1$tp]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Timestamp&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#time-stamp&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Condition&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Condition&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Condition_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Condition [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Condition&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#condition&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_ConditionID&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_ConditionID&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_ConditionID_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Condition ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_ConditionID&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#condition-id&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_IconID&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_IconID&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_IconID_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Icon ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_IconID&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#icon-id&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Icon&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Icon&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Icon_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Icon&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Icon&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#icon&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Temperature&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Temperature&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Temperature&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Temperature_High_1&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Temperature_Low_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Temperature [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Temperature&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#temperature&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Pressure&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Pressure&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Pressure&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Pressure_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Pressure [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Pressure&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#pressure&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Humidity&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Humidity&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Humidity_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Humidity [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Humidity&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Humidity&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#humidity&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_WindSpeed&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_WindSpeed&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_WindSpeed_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Wind speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_WindSpeed&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#wind-speed&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_GustSpeed&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_GustSpeed&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_GustSpeed_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Gust speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_GustSpeed&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#gust-speed&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_WindDirection&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_WindDirection&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Angle&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_WindDirection_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Wind direction [SCALE(windDirection.scale):</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_WindDirection&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#wind-direction&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_Cloudiness&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_Cloudiness&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_Cloudiness_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Cloudiness [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_Cloudiness&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#cloudiness&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_RainVolume&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_RainVolume&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_RainVolume_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Rain volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Rain&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_RainVolume&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#rain&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Current_SnowVolume&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Current_SnowVolume&quot;</span><span class="p">,</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gCurrent&quot;</span><span class="p">,</span> <span class="s2">&quot;gForecast_SnowVolume_1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current: Snow volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Snow&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Current_SnowVolume&quot;</span><span class="p">,</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:current#snow&quot;</span><span class="p">))</span>

            <span class="c1"># create Forecast groups</span>
            <span class="kn">import</span> <span class="nn">calendar</span>
            <span class="kn">from</span> <span class="nn">org.joda.time</span> <span class="kn">import</span> <span class="n">DateTime</span>
            <span class="n">lastReading</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="s2">&quot;Current_Timestamp&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">getDayOfWeek</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="n">dayOfWeek</span> <span class="o">=</span> <span class="s2">&quot;Today&quot;</span> <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[(</span><span class="n">lastReading</span> <span class="o">+</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gOpenWeatherMap&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Timestamp [%1$tY-%1$tm-%1$td %1$tI:%1$tM%1$tp]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Condition [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Condition ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Icon ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Icon&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Temperature (high) [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Temperature_Hot&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Temperature&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Temperature</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Temperature (low) [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Temperature_Cold&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Temperature&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Min</span><span class="p">(</span><span class="n">Temperature</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Pressure [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Pressure&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Pressure</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Humidity [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Humidity&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Dimensionless</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Wind Speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Speed</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Gust Speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Speed</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="c1">#add_item(&quot;gForecast_WindDirection_&quot; + str(index), item_type=&quot;Group&quot;, groups=[&quot;gForecast_&quot; + str(index)], label=dayOfWeek + &quot;: Wind direction [SCALE(windDirection.scale):%s]&quot;, category=&quot;Wind&quot;, gi_base_type=&quot;Number:Angle&quot;, group_function=QuantityTypeArithmeticGroupFunction.Avg(Angle), tags=[&quot;OpenWeatherMap&quot;])# this doesn&#39;t work properly yet</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Wind direction [SCALE(windDirection.scale):</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Angle&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Cloudiness [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Dimensionless</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Rain Volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Rain&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">Length</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Snow Volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Snow&quot;</span><span class="p">,</span> <span class="n">gi_base_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">group_function</span><span class="o">=</span><span class="n">QuantityTypeArithmeticGroupFunction</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">Length</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>

            <span class="c1"># create Forecast Items</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">41</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Timestamp_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Timestamp_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Timestamp [%1$tY-%1$tm-%1$td %1$tI:%1$tM%1$tp]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Timestamp_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#time-stamp&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Condition_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Condition_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Condition [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Condition_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#condition&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_ConditionID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_ConditionID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Condition ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_ConditionID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#condition-id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_IconID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_IconID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Icon ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_IconID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#icon-id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Icon_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Icon_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Icon&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Icon_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#icon&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Temperature&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Temperature [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#temperature&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Pressure_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Pressure_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Pressure&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Pressure [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Pressure_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#pressure&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Humidity_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Humidity_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Humidity [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Humidity&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Humidity_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#humidity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_WindSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_WindSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Wind speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_WindSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#wind-speed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_GustSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_GustSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Speed&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Gust speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_GustSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#gust-speed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_WindDirection_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_WindDirection_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Angle&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Wind direction [SCALE(windDirection.scale):</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_WindDirection_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#wind-direction&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_Cloudiness_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_Cloudiness_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Dimensionless&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Cloudiness [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Sun_Clouds&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_Cloudiness_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#cloudiness&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_RainVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_RainVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Rain volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Rain&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_RainVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#rain&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="s2">&quot;Forecast_SnowVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;Forecast_SnowVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">item_type</span><span class="o">=</span><span class="s2">&quot;Number:Length&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Forecast ({:02d}): Snow volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Snow&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OpenWeatherMap&quot;</span><span class="p">])</span>
                    <span class="n">add_link</span><span class="p">(</span><span class="s2">&quot;Forecast_SnowVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">),</span> <span class="n">ChannelUID</span><span class="p">(</span><span class="n">owmThingUID</span> <span class="o">+</span> <span class="s2">&quot;:forecastHours{:02d}#snow&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>

            <span class="kn">from</span> <span class="nn">core.rules</span> <span class="kn">import</span> <span class="n">rule</span>
            <span class="kn">from</span> <span class="nn">core.triggers</span> <span class="kn">import</span> <span class="n">when</span>

            <span class="nd">@rule</span><span class="p">(</span><span class="s2">&quot;Add OpenWeatherMap Items to daily forecast groups&quot;</span><span class="p">)</span>
            <span class="nd">@when</span><span class="p">(</span><span class="s2">&quot;Item Current_Timestamp changed&quot;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">addOWMItemsToGroups</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="c1"># remove hourly forecast Items from groups</span>
                <span class="k">for</span> <span class="n">groupIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="s2">&quot;Current&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()):</span>
                        <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">removeMember</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>

                <span class="c1"># update group labels to reflect week day</span>
                <span class="kn">from</span> <span class="nn">org.joda.time</span> <span class="kn">import</span> <span class="n">DateTime</span>
                <span class="kn">import</span> <span class="nn">calendar</span>
                <span class="n">lastReading</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="s2">&quot;Current_Timestamp&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">getDayOfWeek</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                    <span class="n">dayOfWeek</span> <span class="o">=</span> <span class="s2">&quot;Today&quot;</span> <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[(</span><span class="n">lastReading</span> <span class="o">+</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="p">]</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Timestamp&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Condition [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Condition ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Icon ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Icon&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Temperature (high) [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Temperature (low) [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Pressure [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Humidity [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Wind Speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Gust Speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Wind direction [SCALE(windDirection.scale):</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Cloudiness [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Rain Volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">dayOfWeek</span> <span class="o">+</span> <span class="s2">&quot;: Snow Volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="p">)</span>

                <span class="c1"># add Forecast Items to groups, and update the labels to reflect time</span>
                <span class="n">groupIndex</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">41</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">DateTime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="s2">&quot;Forecast_Timestamp_{:02}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)]))</span><span class="o">.</span><span class="n">getDayOfWeek</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">!=</span> <span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">getDayOfWeek</span><span class="p">()</span> <span class="o">+</span> <span class="n">groupIndex</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">groupIndex</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="k">break</span><span class="c1"># we&#39;re at the end of the forecasts that fit into 5 days</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">groupIndex</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">labelTime</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="s2">&quot;Forecast_Timestamp_{:02}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;%1$tl:%1$tM%1$tp&quot;</span><span class="p">)</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Timestamp_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Timestamp_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Timestamp_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Timestamp [%1$tY-%1$tm-%1$td %1$tI:%1$tM%1$tp]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Condition_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Condition_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Condition [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_ConditionID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_ConditionID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Condition ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_IconID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_IconID_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Icon ID [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Icon_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Icon_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Icon&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_High_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Temperature [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Temperature_Low_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Temperature_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Temperature [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Pressure_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Pressure_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Pressure_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Pressure [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Humidity_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Humidity_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Humidity_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Humidity [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_WindSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_WindSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Wind speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_GustSpeed_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_GustSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_GustSpeed_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Gust speed [</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_WindDirection_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_WindDirection_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Wind direction [SCALE(windDirection.scale):</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Cloudiness_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Cloudiness_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_Cloudiness_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Cloudiness [</span><span class="si">%d</span><span class="s2"> </span><span class="si">%%</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_RainVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_RainVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_RainVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Rain volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_SnowVolume_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groupIndex</span><span class="p">))</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_SnowVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">)))</span>
                    <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;Forecast_SnowVolume_{:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s2">&quot;Forecast ({}): Snow volume [</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%u</span><span class="s2">nit%]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labelTime</span><span class="p">))</span>

                <span class="c1"># set Condition, Icon and WindDirection group values</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">600</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">]:</span><span class="c1"># the Conditions are organized into groups (https://openweathermap.org/weather-conditions), which I have prioritized</span>
                        <span class="n">forecastItems</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">())</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecastItems</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">sortedItems</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">forecastItems</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="p">()))</span>
                            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">sortedItems</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="c1"># this will provide the highest value in the sorted list of Items, which is usually the most severe condition</span>
                            <span class="n">events</span><span class="o">.</span><span class="n">postUpdate</span><span class="p">(</span><span class="s2">&quot;gForecast_ConditionID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">selectedItem</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
                            <span class="n">events</span><span class="o">.</span><span class="n">postUpdate</span><span class="p">(</span><span class="s2">&quot;gForecast_Condition_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">items</span><span class="p">[</span><span class="n">selectedItem</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
                            <span class="n">events</span><span class="o">.</span><span class="n">postUpdate</span><span class="p">(</span><span class="s2">&quot;gForecast_IconID_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">items</span><span class="p">[</span><span class="n">selectedItem</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Condition&quot;</span><span class="p">,</span> <span class="s2">&quot;Icon&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
                            <span class="n">events</span><span class="o">.</span><span class="n">postUpdate</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_Icon_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">items</span><span class="p">[</span><span class="n">selectedItem</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ConditionID&quot;</span><span class="p">,</span> <span class="s2">&quot;Icon&quot;</span><span class="p">)])</span>
                            <span class="k">break</span>
                    <span class="c1"># this can be removed when QuantityTypeArithmeticGroupFunction.Avg() is fixed for Number:Angle</span>
                    <span class="n">windDirectionItemStates</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">intValue</span><span class="p">(),</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">member</span><span class="p">:</span> <span class="n">member</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">NULL</span> <span class="ow">and</span> <span class="n">member</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">UNDEF</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="o">.</span><span class="n">getMembers</span><span class="p">()))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">windDirectionItemStates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">windDirectionAvg</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(((</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">180</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="n">windDirectionItemStates</span><span class="p">)</span>
                        <span class="n">events</span><span class="o">.</span><span class="n">postUpdate</span><span class="p">(</span><span class="s2">&quot;gForecast_WindDirection_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">windDirectionAvg</span><span class="p">))</span>

                <span class="n">addOWMItemsToGroups</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updated groups and Items&quot;</span><span class="p">)</span>

            <span class="n">addOWMItemsToGroups</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">traceback</span>
        <span class="n">addOWMItems</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">scriptLoaded</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="n">addOWMItems</span><span class="p">()</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    
      
        <div align="right">
          
            <br/>
            <a href="https://github.com/openhab-scripters/openhab-helper-libraries/blob/master/Sphinx/Python/Community/OpenWeatherMap.rst" class="fa fa-github"> Edit on GitHub</a>
          
        </div>
      
    
  

  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Contributors to the openHAB Scripters project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>